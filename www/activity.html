<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <title>Activity details</title>
    <link href="style.css" type="text/css" rel="stylesheet" />
    <link href="jquery-ui.min.css" type="text/css" rel="stylesheet" />
    <link href="jquery-ui.structure.min.css" type="text/css" rel="stylesheet" />
    <link href="jquery-ui.theme.min.css" type="text/css" rel="stylesheet" />
    <script src="jquery-3.2.1.js"></script>
    <script src="jquery-ui.min.js"></script>
    <script src="js/jquery.tablesorter.js"></script>
    <script src="js/jquery.tablesorter.widgets.js"></script>
    <script src="js/parsers/parser-ipv6.js"></script>
    <script src="js/jquery.metadata.js"></script>
	
	<script>
	
		function formatEleDiff(diff) {
            if (diff == 0) {
                return '0';
            }
            if (diff > 0) {
                return '<span class="green">+' + diff + '</span>';
            }
            return '<span class="red">' + diff + '</span>';
        }
	
		function round(point) {
            if (Math.abs(point - Math.round(point)) < 1e-3) {
                return Math.round(point);
            }
            return point;
        }
		
		function init(item) {
			distr = item['speedDist'];
            tableHtml = '<span class="highlight"><table style="margin: auto;"><thead><th>Range</th><th>Time</th><th>Distance</th><th>Gain</th><th>Loss</th></thead><tbody>';
            $.each(distr, function(i, diap) {
                tableHtml += '<tr><td><strong>' + diap['range'] + ' km/h</strong></td><td>' + diap['time'] + '</td><td>' + diap['dist'] + '</td><td><span class="green">' + diap['elePos'] + '</span></td><td><span class="red">' + diap['eleNeg'] + '</span></td></tr>';
            });
            tableHtml += '</tbody></table></span>';
            splits = item['splits'];
            splitHtml = '<span class="highlight"><table style="margin: auto;"><thead><th>Point(km)</th><th>Pace</th><th>Avg speed</th><th>Diff</th><th>Total time</th><th>Acc speed</th></thead><tbody>';
            $.each(splits, function(i, sp) {
                splitHtml += '<tr><td><strong>' + round(sp['total']) + '</strong></td><td>' + sp['pace'] + '</td><td>' + sp['speed'] + '</td><td>' + formatEleDiff(sp['ele']) + '</td><td>' + sp['timeTotal'] +
				'</td><td>' + sp['accumSpeed'] + '</td></tr>';
            });
            splitHtml += '</tbody></table></span>';
            linkHtml = '';
            if (item['garminLink'] != 'none') {
                linkHtml = '</ul><a href="' + item['garminLink'] + '" target="_blank"><h3>Garmin Connect</h3></a><ul>';
            }
            $('#data').html('<h3>General</h3><table class="highlightOnly" style="margin: auto;"><tbody><tr><td>Name</td><td>' + decodeURIComponent(item['name']) + '</td></tr><tr><td>Type</td><td>' + item['type'] + '</td></tr>'
				+ '<tr><td>Date</td><td>' + item['date'] + '</td></tr><tr><td>Distance(km)</td><td>' + item['dist'] + '</td></tr><tr><td>Total time</td><td>' + item['timeTotal'] + '</td></tr><tr><td>Elevation gain(m)</td><td>' +
                '<span class="green">' + item['eleTotalPos'] + '</span></td></tr><tr><td>Elevation loss(m)</td><td>' + '<span class="red">' + item['eleTotalNeg'] + '</span></td></tr><tr><td>' +
                'Running time(>9km/h)</td><td>' + item['timeRunning'] + '</td></tr><tr><td>Running distance(km)</td><td>' + item['distRunning'] + '</td></tr><tr><td>Running elevation gain(m)</td><td>' + '<span class="green">' + item['eleRunningPos'] + '</span></td></tr><tr><td>Running elevation loss(m)</td><td>' +
                '<span class="red">' + item['eleRunningNeg'] + '</span></td></tr><tr><td>Rest time</td><td>' + item['timeRest'] + '</td></tr><tr><td>Average speed(km/h)</td><td>' + item['avgSpeed'] + '</td></tr><tr><td>Average pace(min/km)</td><td>' + item['avgPace'] + '</td></tr></tbody></table>' + linkHtml + '<h3>Speed distribution</h3>' +
                tableHtml + '<h3>Splits</h3>' + splitHtml);
		}
		
		$(document).ready(function() {
			$.ajax({
                url: 'TBD',
                method: 'POST',
                dataType: 'json',
				headers: {
                    'Content-Type': 'application/json'
                },
                statusCode: {
                    200: function(data) {
							init(data);
                        }
                }
			});
		});
	</script>
</head>

<body>
	<div id="data" style="text-align:center;font-size: 120%">
	</div>
</body>

</html>