<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<title>Running stats</title>
<link href="style.css" type="text/css" rel="stylesheet" />
<link href="jquery-ui.min.css" type="text/css" rel="stylesheet" />
<link href="jquery-ui.structure.min.css" type="text/css" rel="stylesheet" />
<link href="jquery-ui.theme.min.css" type="text/css" rel="stylesheet" />
<script src="jquery-3.2.1.js"></script>
<script src="jquery-ui.min.js"></script>
<script>
function loadActivities() {
$.post('loadActivities', function( data ) {
  $("#details").dialog({
    autoOpen : false, modal : true, show : "blind", hide : "blind", buttons: {
            "Close": function() {
                $(this).dialog("close");
            }
        },
        width: 600,
        height: 800,
  });
  all = data['activities'];
  $("#activities").append('<table id="runs" cellspacing="0" summary="Running and hiking activities">');
  $("#activities").append('<tr><th>Date</th><th>Name</th><th>Distance</th><th>Time</th><th>Pace</th><th>Speed</th></tr>');
  $.each(all, function(i, item) {
	$("#activities").append('<tr>');
	$("#activities").append('<td>' + item['date'] + '</td><td><div class="runitem" id="item' + i + '">' + item['name'] + '</div></td><td>' + item['dist'] + ' km</td><td>' + item['timeTotal'] + '</td><td>' + item['avgPace'] + ' min/km</td><td>' + item['avgSpeed'] + ' km/h</td>');
	$("#activities").append('</tr>');
	id = "data" + i;
	$("#activities").append('<div style="display: none;" id="data' + i + '"></div>');
	distr = item['speedDist'];
	tableHtml = '<table><th>Range</th><th>Time</th><th>Distance</th><th>Gain</th><th>Loss</th>';
	$.each(distr, function(i, diap) {
		tableHtml += '<tr><td>' + diap['range'] + ' km/h</td><td>' + diap['time']  + '</td><td>' + diap['dist'] + ' km</td><td>' + diap['elePos']  +  ' m</td><td>' + diap['eleNeg']  + ' m</td></tr>';
	});
	tableHtml += '</table>';
	splits = item['splits'];
	splitHtml = '<table><th>Total</th><th>Pace</th><th>Speed</th><th>Diff</th>';
	$.each(splits, function(i, sp) {
		splitHtml += '<tr><td>' + sp['total'] + ' km</td><td>' + sp['pace'] + ' min/km</td><td>' + sp['speed'] + ' km/h</td><td>' + sp['ele'] + ' m</td></tr>';
	});
	splitHtml += '</table>';
	linkHtml = '';
	if (item.hasOwnProperty('garminLink')) {
		linkHtml = '</ul><a href="' + item['garminLink'] + '" target="_blank">Garmin Connect</a><ul>';
	}
	$('#' + id).append('<ul><li>On ' + item['date'] + '</li><li>Distance ' + item['dist'] + ' km</li><li>Total time ' + item['timeTotal'] + '</li><li>Elevation gain ' + item['eleTotalPos'] + ' m</li><li>Elevation loss ' + item['eleTotalNeg'] + ' m</li>' +
		'<li>Running(>=9.0km/h) time ' + item['timeRunning'] + '</li><li>Running distance ' + item['distRunning'] + ' km</li><li>Running elevation gain ' + item['eleRunningPos'] + ' m</li><li>Running elevation loss ' + item['eleRunningNeg'] +
		' m</li><li>Rest time ' + item['timeRest'] + '</li><li>Average speed ' + item['avgSpeed'] + ' km/h</li>' + linkHtml + '<li>Speed distribution' +
		'</li>' + tableHtml + '</li><li>Splits</li>' + splitHtml + '</ul>');
	$('#item' + i).click(function(){
		$("#details").html($('#data' + i).html());
		$("#details").dialog('option', 'title', 'Details ' + item['name']);
		$("#details").dialog('open');
	});
	console.log(i);
	console.log(item);
  });
  $("#activities").append('</table>');
});
}
</script>
</head>
<body onload = "loadActivities();">
<div id = "heading">
	<H1><strong>Running stats</strong></H1> 
</div>
<div id = "activities">
	<h2>Activities</h2>
</div>
<div id = "details">
</div>
</body>
</html>