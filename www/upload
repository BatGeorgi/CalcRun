<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <title>Upload Activity</title>
    <link href="jquery-ui.min.css" type="text/css" rel="stylesheet" />
    <link href="jquery-ui.structure.min.css" type="text/css" rel="stylesheet" />
    <link href="jquery-ui.theme.min.css" type="text/css" rel="stylesheet" />
    <script src="jquery-3.2.1.js"></script>
    <script src="jquery-ui.min.js"></script>
    <script src="js/jquery.tablesorter.js"></script>
    <script src="js/jquery.tablesorter.widgets.js"></script>
    <script src="js/parsers/parser-ipv6.js"></script>
    <script src="js/jquery.metadata.js"></script>
	
	<script>
	
		function authorization() {
			$.ajax({
                url: 'authorize',
                method: 'POST',
                dataType: 'json',
                headers: {
                    'Content-Type': 'application/json',
					'Password': $('#pass').val()
                },
                statusCode: {
                    200: function(data) {
						alert('Authorized, token valid for 5 minutes');
						$('#upload').attr('action', 'upload' + data['token']);
						$('#pass').val('');
						$("#submit").button('option', 'disabled', false);
						$("#authorize").button('option', 'disabled', true);
					},
					401: function(data) {
						alert('DGD boklik!');
						$('#pass').val('');
					}
				}
			});
		}
	
		$(document).ready(function() {
			$('#authorize').button();
			$('#fileToUpload').button();
			$('#submit').button();
			$('#authorize').click(authorization); 
			$("#upload").submit(function( event ) {
				suff = "." + encodeURIComponent($('#name').val()) +  "." + $('#type').find(':selected').val();
				initVal = $('#upload').attr('action');
				$('#upload').attr('action', initVal + suff);
			});
		});
	</script>
</head>

<body style="text-align:center">
    <H1><strong>Upload gpx track</strong></H1>
    <table style="text-align:left; margin:auto;">
        <tbody>
            <tr>
                <td>Security key&nbsp;</td>
                <td><input type="password" id="pass" />&nbsp;<button id="authorize">Authorize</button></td>
            </tr>
            <tr>
                <td>
                    <p>Activity name&nbsp;</td>
                <td><input type="text" id="name" /></td>
            </tr>
            <tr>
                <td>
                    <p>Activity type&nbsp;</td>
                <td>
                    <select id="type">
						<option id="running" value="Running" selected>Running</option>
						<option id="trail" value="Trail">Trail</option>
						<option id="hiking" value="Hiking">Hiking</option>
						<option id="walking" value="Walking">Walking</option>
						<option id="other" value="Other">Other</option>
					</select>
                </td>
            </tr>
            <tr>
                <td>
                    <p>Select file&nbsp;</td>
                <td>
                    <form id="upload" action="upload1" method="post" enctype="multipart/form-data">
                        <input type="file" name="fileToUpload" id="fileToUpload" />
                        <input type="submit" value="Upload" name="submit" id="submit" disabled/>
                    </form>
                </td>
            </tr>
        </tbody>
    </table>
    <a href="runcalc">
        <h2>Go to main page</h2>
    </a>
</body>

</html>